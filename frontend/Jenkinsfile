//Jenkinsfile Frontend Dev or Prod (Declarative Pipeline)

 pipeline 
{
    agent{
        docker {
            image 'docker.io/vitvizel/agent:v1'
            args -v "\\.\pipe\docker_engine:\\.\pipe\docker_engine"

        }
    }
     

    options {
                buildDiscarder(logRotator(daysToKeepStr: '30'))
                disableConcurrentBuilds()
                timestamps()
                timeout(time: 20, unit: 'MINUTES')
}

    stages {
        stage('Build Frontend')
        {
           
            steps 
            {
            
                bat "docker build -f frontend\\${params.Env}.Dockerfile -t vitvizel/timeapp-jenkins-frontend:${params.Env}.${env.BUILD_NUMBER} ."
                   echo " The environment is ${params.Env}"

            }
        }            
        stage('Push Frontend')  
        { 
            steps 
            { 
                withCredentials([usernamePassword(credentialsId: 'dockerhub', passwordVariable: 'pass', usernameVariable: 'user')])   
                {  
                bat "docker login -u $user -p $pass"
                bat "docker push vitvizel/timeapp-jenkins-frontend:${params.Env}.${env.BUILD_NUMBER}"
                }
            }

        }
           
        }
    

            post 
            {
                always 
                {
                deleteDir() /* clean up our workspace */
                }
            }
}




